"use strict";(()=>{var e={};e.id=405,e.ids=[405,888,660],e.modules={6903:(e,t,r)=>{r.r(t),r.d(t,{config:()=>$,default:()=>T,getServerSideProps:()=>B,getStaticPaths:()=>O,getStaticProps:()=>z,reportWebVitals:()=>H,routeModule:()=>K,unstable_getServerProps:()=>V,unstable_getServerSideProps:()=>X,unstable_getStaticParams:()=>G,unstable_getStaticPaths:()=>W,unstable_getStaticProps:()=>Z});var n={};r.r(n),r.d(n,{default:()=>E});var s=r(7093),i=r(5244),o=r(1323),a=r(9209),l=r.n(a),c=r(8568),d=r(997),u=r(6689),p=r(8087),h=r.n(p),x=r(2167),m=r.n(x),g=r(1854),j=r.n(g),f=r(1831),v=r(3281),S=r(3452);let b=require("react-cropper");var C=r.n(b);let Post_CropImageModal=function({mediaPreview:e,setMedia:t,showModal:r,setShowModal:n}){let[s,i]=(0,u.useState)();return(0,u.useEffect)(()=>{window.addEventListener("keydown",({key:e})=>{s&&("m"===e&&s.setDragMode("move"),"c"===e&&s.setDragMode("crop"),"r"===e&&s.reset())})},[s]),d.jsx(d.Fragment,{children:(0,d.jsxs)(f.Modal,{closeOnDimmerClick:!1,size:"large",onClose:()=>n(!1),open:r,children:[d.jsx(f.Modal.Header,{content:"Crop image before upload"}),(0,d.jsxs)(f.Grid,{columns:2,children:[d.jsx(f.Grid.Column,{children:d.jsx(f.Modal.Content,{image:!0,children:d.jsx(C(),{style:{height:"400px",width:"100%"},cropBoxResizable:!0,zoomable:!0,highlight:!0,responsive:!0,guides:!0,dragMode:"move",initialAspectRatio:1,preview:".img-preview",src:e,viewMode:1,minCropBoxHeight:10,minContainerWidth:10,background:!1,autoCropArea:1,checkOrientation:!1,onInitialized:e=>i(e)})})}),d.jsx(f.Grid.Column,{children:d.jsx(f.Modal.Content,{image:!0,children:(0,d.jsxs)("div",{children:[(0,d.jsxs)(f.Header,{as:"h2",children:[d.jsx(f.Icon,{name:"file image outline"}),d.jsx(f.Header.Content,{content:"Final"})]}),d.jsx("div",{children:d.jsx("div",{style:{width:"100%",height:"300px",display:"inline-block",padding:"10px",overflow:"hidden",boxSizing:"border-box"},className:"img-preview"})})]})})})]}),(0,d.jsxs)(f.Modal.Actions,{children:[d.jsx(f.Button,{title:"Reset (R)",icon:"redo",circular:!0,onClick:()=>s&&s.reset()}),d.jsx(f.Button,{title:"Move Canvas (M)",icon:"move",circular:!0,onClick:()=>s&&s.setDragMode("move")}),d.jsx(f.Button,{title:"New Cropbox (C)",icon:"crop",circular:!0,onClick:()=>s&&s.setDragMode("crop")}),d.jsx(f.Button,{negative:!0,content:"Cancel",icon:"cancel",onClick:()=>n(!1)}),d.jsx(f.Button,{content:"Crop Image",icon:"checkmark",positive:!0,onClick:()=>{s&&(t(s.getCroppedCanvas().toDataURL()),s.destroy()),n(!1)}})]})]})})},Post_CreatePost=function({user:e,setPosts:t}){let[r,n]=(0,u.useState)({text:"",location:""}),[s,i]=(0,u.useState)(!1),o=(0,u.useRef)(),[a,l]=(0,u.useState)(null),[c,p]=(0,u.useState)(!1),[h,x]=(0,u.useState)(null),[m,g]=(0,u.useState)(null),[j,b]=(0,u.useState)(!1),handleChange=e=>{let{name:t,value:r,files:s}=e.target;"media"===t&&s&&s.length>0&&(x(s[0]),g(URL.createObjectURL(s[0]))),n(e=>({...e,[t]:r}))},handleSubmit=async e=>{let s;if(e.preventDefault(),i(!0),null!==h&&!(s=await (0,v.Z)(h)))return i(!1),l("Error Uploading Image");await (0,S.hD)(r.text,r.location,s,t,n,l),x(null),m&&URL.revokeObjectURL(m),setTimeout(()=>g(null),3e3),i(!1)};return(0,d.jsxs)(d.Fragment,{children:[j&&d.jsx(Post_CropImageModal,{mediaPreview:m,setMedia:x,showModal:j,setShowModal:b}),(0,d.jsxs)(f.Form,{error:null!==a,onSubmit:handleSubmit,children:[d.jsx(f.Message,{error:!0,onDismiss:()=>l(null),content:a,header:"Oops!"}),(0,d.jsxs)(f.Form.Group,{children:[d.jsx(f.Image,{src:e.profilePicUrl,circular:!0,avatar:!0,inline:!0}),d.jsx(f.Form.TextArea,{placeholder:"Share The Pain \uD83E\uDD72 ï¼ƒBugsFree",name:"text",value:r.text,onChange:handleChange,rows:4,width:14})]}),(0,d.jsxs)(f.Form.Group,{children:[d.jsx(f.Form.Input,{value:r.location,name:"location",onChange:handleChange,label:"Add Location",icon:"map marker alternate",placeholder:"Share Your Location"}),d.jsx("input",{ref:o,onChange:handleChange,name:"media",style:{display:"none"},type:"file",accept:"image/*"})]}),d.jsx("div",{onClick:()=>o.current.click(),style:{textAlign:"center",height:"150px",width:"150px",border:"dotted",paddingTop:null===h&&"60px",cursor:"pointer",borderColor:c?"green":"black"},onDragOver:e=>{e.preventDefault(),p(!0)},onDragLeave:e=>{e.preventDefault(),p(!1)},onDrop:e=>{e.preventDefault(),p(!0);let t=Array.from(e.dataTransfer.files);x(t[0]),g(URL.createObjectURL(t[0]))},children:null===h?d.jsx(f.Icon,{name:"plus",size:"big"}):d.jsx(f.Image,{style:{height:"150px",width:"150px"},src:m,alt:"PostImage",centered:!0,size:"medium"})}),null!==m&&(0,d.jsxs)(d.Fragment,{children:[d.jsx(f.Divider,{hidden:!0}),d.jsx(f.Button,{content:"Crop Image",type:"button",primary:!0,circular:!0,onClick:()=>b(!0)})]}),d.jsx(f.Divider,{hidden:!0}),d.jsx(f.Button,{circular:!0,disabled:""===r.text||s,content:d.jsx("strong",{children:"Post"}),style:{backgroundColor:"#1DA1F2",color:"white"},icon:"send",loading:s})]}),d.jsx(f.Divider,{})]})};var P=r(1392),w=r(3053),M=r(8983),_=r(7968);let k=require("react-infinite-scroll-component");var y=r.n(k),I=r(5251),D=r(6734),F=r.n(D),N=r(4493),L=r(1664),q=r.n(L),A=r(8105);let Instructions=({username:e})=>(0,d.jsxs)(f.List,{children:[(0,d.jsxs)(f.List.Item,{children:[d.jsx(f.Icon,{name:"help"}),d.jsx(f.List.Content,{children:d.jsx(f.List.Header,{children:"You can disable this feature by:"})})]}),(0,d.jsxs)(f.List.Item,{children:[d.jsx(f.Icon,{name:"hand point right"}),(0,d.jsxs)(f.List.Content,{children:[" Navigating to your",d.jsx(q(),{href:`/${e}`,children:d.jsx("a",{children:" Account "})}),"Page and clicking on Settings Tab."]})]}),(0,d.jsxs)(f.List.Item,{children:[d.jsx(f.Icon,{name:"hand point right"}),"Inside the menu, there is a setter called : Show New Message Popup?"]}),(0,d.jsxs)(f.List.Item,{children:[d.jsx(f.Icon,{name:"hand point right"}),"Just toggle it ON /OFF for personal preferences."]})]}),Home_MessageNotificationModal=function({socket:e,showNewMessageModal:t,newMessageModal:r,newMessageReceived:n,user:s}){let[i,o]=(0,u.useState)(""),[a,l]=(0,u.useState)(!1);return d.jsx(d.Fragment,{children:(0,d.jsxs)(f.Modal,{size:"small",open:r,onClose:()=>t(!1),closeIcon:!0,closeOnDimmerClick:!0,children:[d.jsx(f.Modal.Header,{content:`New Message from ${n.senderName}`}),(0,d.jsxs)(f.Modal.Content,{children:[(0,d.jsxs)("div",{className:"bubbleWrapper",children:[d.jsx("div",{className:"inlineContainer",children:d.jsx("img",{className:"inlineIcon",src:n.senderProfilePic})}),d.jsx("div",{className:"otherBubble other",children:n.msg}),d.jsx("span",{className:"other",children:(0,A.Z)(n.date)})]}),d.jsx("div",{style:{position:"sticky",bottom:"0px"},children:d.jsx(f.Segment,{secondary:!0,color:"teal",attached:"bottom",children:d.jsx(f.Form,{reply:!0,onSubmit:r=>{r.preventDefault(),e.current&&(e.current.emit("sendMsgFromNotification",{userId:s._id,msgSendToUserId:n.sender,msg:i}),e.current.on("msgSentFromNotification",()=>{t(!1)}))},children:d.jsx(f.Form.Input,{size:"large",placeholder:"Send New Message",value:i,onChange:e=>o(e.target.value),action:{color:"blue",icon:"telegram plane",disabled:""===i,loading:a}})})})}),(0,d.jsxs)("div",{style:{marginTop:"5px"},children:[d.jsx(q(),{href:`/messages?message=${n.sender}`,children:d.jsx("a",{children:"View All Messages"})}),d.jsx("br",{}),d.jsx(Instructions,{username:s.username})]})]})]})})};var R=r(7485),U=r(1163);let Home_NotificationPortal=function({newNotification:e,notificationPopup:t,showNotificationPopup:r}){let n=(0,U.useRouter)(),{name:s,profilePicUrl:i,username:o,postId:a}=e;return d.jsx(f.TransitionablePortal,{transition:{animation:"fade left",duration:"500"},onClose:()=>t&&r(!1),onOpen:R.Z,open:t,children:(0,d.jsxs)(f.Segment,{style:{right:"5%",position:"fixed",top:"10%",zIndex:1e3},children:[d.jsx(f.Icon,{name:"close",size:"large",style:{float:"right",cursor:"pointer"},onClick:()=>r(!1)}),d.jsx(f.Feed,{children:(0,d.jsxs)(f.Feed.Event,{children:[d.jsx(f.Feed.Label,{children:d.jsx("img",{src:i})}),d.jsx(f.Feed.Content,{children:(0,d.jsxs)(f.Feed.Summary,{children:[(0,d.jsxs)(f.Feed.User,{onClick:()=>n.push(`/${o}`),children:[s," "]})," ","liked your ",d.jsx("a",{onClick:()=>n.push(`/post/${a}`),children:" post"}),d.jsx(f.Feed.Date,{children:(0,A.Z)(Date.now())})]})})]})})]})})};function Index({user:e,postsData:t,errorLoading:r}){let[n,s]=(0,u.useState)(t||[]),[i,o]=(0,u.useState)(!1),[a,l]=(0,u.useState)(!0),[c,p]=(0,u.useState)(2),x=(0,u.useRef)(),[g,v]=(0,u.useState)(null),[S,b]=(0,u.useState)(!1),[C,w]=(0,u.useState)(null),[k,D]=(0,u.useState)(!1);(0,u.useEffect)(()=>(x.current||(x.current=h()(j())),x.current&&(x.current.emit("join",{userId:e._id}),x.current.on("newMsgReceived",async({newMsg:t})=>{let{name:r,profilePicUrl:n}=await (0,N.Z)(t.sender);e.newMessagePopup&&(v({...t,senderName:r,senderProfilePic:n}),b(!0)),(0,R.Z)(r)})),document.title=`Welcome, ${e.name.split(" ")[0]}`,()=>{x.current&&(x.current.emit("disconnect"),x.current.off())}),[]),(0,u.useEffect)(()=>{i&&setTimeout(()=>o(!1),3e3)},[i]);let fetchDataOnScroll=async()=>{try{let e=await m().get(`${j()}/api/posts`,{headers:{Authorization:F().get("token")},params:{pageNumber:c}});0===e.data.length&&l(!1),s(t=>[...t,...e.data]),p(e=>e+1)}catch(e){alert("Error fetching Posts")}};return(0,u.useEffect)(()=>{x.current&&x.current.on("newNotificationReceived",({name:e,profilePicUrl:t,username:r,postId:n})=>{w({name:e,profilePicUrl:t,username:r,postId:n}),D(!0)})},[]),(0,d.jsxs)(d.Fragment,{children:[k&&null!==C&&d.jsx(Home_NotificationPortal,{newNotification:C,notificationPopup:k,showNotificationPopup:D}),i&&d.jsx(_.g0,{}),S&&null!==g&&d.jsx(Home_MessageNotificationModal,{socket:x,showNewMessageModal:b,newMessageModal:S,newMessageReceived:g,user:e}),(0,d.jsxs)(f.Segment,{children:[d.jsx(Post_CreatePost,{user:e,setPosts:s}),0===n.length||r?d.jsx(M.o0,{}):d.jsx(y(),{hasMore:a,next:fetchDataOnScroll,loader:d.jsx(I.pj,{}),endMessage:d.jsx(I.SC,{}),dataLength:n.length,children:n.map(t=>d.jsx(P.Z,{socket:x,post:t,user:e,setPosts:s,setShowToastr:o},t._id))})]})]})}Index.getInitialProps=async e=>{try{let{token:t}=(0,w.parseCookies)(e),r=await m().get(`${j()}/api/posts`,{headers:{Authorization:t},params:{pageNumber:1}});return{postsData:r.data}}catch(e){return{errorLoading:!0}}};let E=Index,T=(0,o.l)(n,"default"),z=(0,o.l)(n,"getStaticProps"),O=(0,o.l)(n,"getStaticPaths"),B=(0,o.l)(n,"getServerSideProps"),$=(0,o.l)(n,"config"),H=(0,o.l)(n,"reportWebVitals"),Z=(0,o.l)(n,"unstable_getStaticProps"),W=(0,o.l)(n,"unstable_getStaticPaths"),G=(0,o.l)(n,"unstable_getStaticParams"),V=(0,o.l)(n,"unstable_getServerProps"),X=(0,o.l)(n,"unstable_getServerSideProps"),K=new s.PagesRouteModule({definition:{kind:i.x.PAGES,page:"/index",pathname:"/",bundlePath:"",filename:""},components:{App:c.default,Document:l()},userland:n})},4493:(e,t,r)=>{r.d(t,{Z:()=>c});var n=r(2167),s=r.n(n),i=r(1854),o=r.n(i),a=r(6734),l=r.n(a);let getUserInfo=async e=>{try{let t=await s().get(`${o()}/api/chats/user/${e}`,{headers:{Authorization:l().get("token")}});return{name:t.data.name,profilePicUrl:t.data.profilePicUrl}}catch(e){console.error(e)}},c=getUserInfo},7485:(e,t,r)=>{r.d(t,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});let __WEBPACK_DEFAULT_EXPORT__=e=>{let t=new Audio("/light.mp3");t&&t.play(),e&&(document.title=`New message from ${e}`,"visible"===document.visibilityState&&setTimeout(()=>{document.title="Messages"},5e3))}},8839:e=>{e.exports=require("@artsy/fresnel")},2167:e=>{e.exports=require("axios")},6734:e=>{e.exports=require("js-cookie")},4042:e=>{e.exports=require("lodash/range")},2245:e=>{e.exports=require("moment")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{e.exports=require("next/head")},3053:e=>{e.exports=require("nookies")},808:e=>{e.exports=require("nprogress")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},661:e=>{e.exports=require("react-moment")},1187:e=>{e.exports=require("react-toastify")},997:e=>{e.exports=require("react/jsx-runtime")},1831:e=>{e.exports=require("semantic-ui-react")},8087:e=>{e.exports=require("socket.io-client")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var t=require("../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[761,375,209,450,568,13,930,315],()=>__webpack_exec__(6903));module.exports=r})();